<div id="article-props-container" _="
  ---on load
  ---  add focus to #inpTitle
  ---end
">
  <h1>Article status: <span id="article-status">{% if article.draft %}draft{% else %}published{% endif %}</span></h1>
  <form>
    <label for="">Title</label>
    <input autofocus type="text" name="title" id="inpTitle" value="{{ article.title }}">
    <label for="">Slug</label>
    <input type="text" name="slug" id="inpSlug" value="{{ article.slug }}">
    <label for="">Date</label>
    <input type="date" name="date" id="inpDate" value="{{ article.date }}">
    <label for="">Tags</label>
    <input type="text" name="tags" id="inpTags" value="{{ article.tags }}">
    <label for="">Main image</label>
    <input type="file" name="mainImage" id="inpMainImage">
    <label for="">Main image size</label>
    <select name="imageclass" id="selImageClass">
      <option value="">--Choose--</option>
      <option value="small">Small</option>
      <option value="medium">Medium</option>
      <option value="large">Full column</option>
      <option value="full">Full screen-width</option>
    </select>

    <!-- SEND DATA FROM LOCALSTORAGE INSTEAD -->
    <!--
      hx-vals="js:{
          content: document.getElementById('editBox').value,
          draft: true,
          slug: '{{ article.slug }}'
      }"
    -->

    <div class="button-group">
      {% if not article.draft %}
      <button
        class="fullwidth green"
        id="unpublish"
        hx-post="/admin/article/{{ article.slug }}/unpublish"
        hx-swap="beforeend"
        hx-indicator="#unpublishLoading"
        hx-vals="js:{
            md: localStorage.getItem('article_{{ article.id }}'),
            article_id: {{ article.id }}
        }"
        hx-select=".status"
        hx-on::after-request="showAfterRequest('unpublishAction', 1000)"
        _="on click hide #unpublishAction"
      >
        <span id="unpublishAction">Unpublish</span>
        <span class="spinner" id="unpublishLoading"></span>
      </button>
      {% endif %}

      <button
        data-articleid="{{ article.id }}"
        class="fullwidth"
        id="publish"
        hx-post="/admin/article/{{ article.slug }}/publish"
        hx-swap="beforeend"
        hx-indicator="#publishLoading"
        hx-vals="js:{
            md:           localStorage.getItem('article_{{ article.id }}'),
            article_id:   {{ article.id }},
            slug:         document.getElementById('inpSlug').value,
            title:        document.getElementById('inpTitle').value,
            date:         document.getElementById('inpDate').value,
            tags:         document.getElementById('inpTags').value,
            main_image:   document.getElementById('inpMainImage').value,
            image_class:  document.getElementById('selImageClass').value
        }"
        hx-select=".status"
        hx-on::after-request="showAfterRequest('publish', 'publishAction', 1000)"
        _="on click hide #publishAction"
      >
        <span id="publishAction">Publish {% if not article.draft %}changes{% endif %}</span>
        <span class="spinner" id="publishLoading"></span>
      </button>
    </div>
  </form>
</div>
<script>
  function showAfterRequest(){
    const bt = document.getElementById("publish")
    const article_id = bt.dataset.articleid;
    console.log(article_id);
  }
</script>

<script type="text/hyperscript" data-articleid="{{ article.id }}">
  def showAfZterRequest(action, elementId, waitms)
    set data to document.currentScript.dataset
    set article_id to data.articleid
    log article_id
    if action is 'publish'
      ---remove 'article_{{ article.id }}' from localStorage
      localStorage.removeItem('article_{{ article.id }}')
    end
  --- NOTE: The following can also be done like this:
  --- wait waitms then hide .status then show #{elementId}
  --  wait waitms
  --  hide .status
  --  show #{elementId}
  --  if elementId is "unpublishAction"
  --      show #savedraft
  --      hide #unpublish
  --      set #poststatus.innerHTML to 'Draft'
  --  else
  --      if elementId is "publishAction"
  --          hide #savedraft
  --          show #unpublish
  --          set #poststatus.innerHTML to 'Published'
  --      end
  --  end
  end
</script>
<style>
.button-group {
  margin: 40px 0 20px;
}
#article-props-container {
  padding: 30px;
  font-size: 0.8rem;
}
#article-props-container h1 {
  font-size: 1rem;
}
input[type=checkbox] {
  width: 20px;
  height: 20px;
}
</style>