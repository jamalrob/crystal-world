<div id="article-props-container">
  <h1>Article status: <span id="article-status">{% if article.draft %}draft{% else %}published{% endif %}</span></h1>
  <form>
    <label for="">Title</label>
    <input autofocus type="text" name="title" id="inpTitle" value="{{ article.title }}">
    <label for="">Slug</label>
    <input type="text" name="slug" id="inpSlug" value="{{ article.slug }}">
    <label for="">Date</label>
    <input type="date" name="date" id="inpDate" value="{{ article.date }}">
    <label for="">Tags</label>
    <input type="text" name="tags" id="inpTags" value="{{ article.tags }}">
    <label for="">Main image</label>
    <input type="file" name="mainImage" id="inpMainImage">
    <label for="">Main image size</label>
    <select name="imageclass" id="selImageClass">
      <option value="">--Choose--</option>
      <option value="small">Small</option>
      <option value="medium">Medium</option>
      <option value="large">Full column</option>
      <option value="full">Full screen-width</option>
    </select>

    <div class="button-group">
      {% if not article.draft %}
      <button
        class="fullwidth green"
        id="unpublish"
        hx-post="/admin/article/{{ article.slug }}/unpublish"
        hx-swap="none"
        hx-indicator="#unpublishLoading"
        hx-vals="js:{
            md: localStorage.getItem('article_{{ article.id }}'),
            article_id: {{ article.id }}
        }"
        hx-select=".status"
        hx-on::after-request="afterRequest('unpublish')"
      >
        <span id="unpublishAction">Unpublish</span>
        <span class="spinner spinner--hidden" id="unpublishLoading"></span>
      </button>
      {% endif %}

      <button
        data-articleid="{{ article.id }}"
        class="fullwidth"
        id="publish"
        hx-post="/admin/article/{{ article.slug }}/publish"
        hx-swap="none"
        hx-indicator="#publishLoading"
        hx-vals="js:{
            md:           localStorage.getItem('article_{{ article.id }}') || document.getElementById('edit-box').innerText,
            article_id:   {{ article.id }},
            slug:         document.getElementById('inpSlug').value,
            title:        document.getElementById('inpTitle').value,
            date:         document.getElementById('inpDate').value,
            tags:         document.getElementById('inpTags').value,
            main_image:   document.getElementById('inpMainImage').value,
            image_class:  document.getElementById('selImageClass').value
        }"
        hx-select=".status"
        hx-on::after-request="afterRequest('publish')"
      >
        <span id="publishAction">Publish {% if not article.draft %}changes{% endif %}</span>
        <span class="spinner spinner--hidden" id="publishLoading"></span>
      </button>
    </div>
    <div id="confirm-published">
    </div>

  </form>
</div>
<script type="text/hyperscript">
  def afterRequest(action, elementId, waitms)
    if action is 'publish'
      localStorage.removeItem('article_' + #publish.dataset.articleid)
      put "Publish changes" into #publishAction
      show <button#unpublish/>
      put "published" into #article-status
      put "✓ Published" into #confirm-published
    end
    if action is 'unpublish'
      localStorage.removeItem('article_' + #publish.dataset.articleid)
      put "draft" into #article-status
      hide <button#unpublish/>
      put "Publish" into #publishAction
      put '✓ Unpublished' into #confirm-published
    end
    wait for 3s
    if #confirm-published is not empty
      put '' into #confirm-published
    end
  end
</script>
<style>
  #confirm-published {
    height: 30px;
  }
  .spinner {
    position: absolute;
    top: calc(50% - 0.55rem);
    width: 1rem;
    height: 1rem;
    border: 0.15rem solid #ffc000;
    border-bottom-width: 0.15rem;
    border-bottom-style: solid;
    border-bottom-color: rgb(255, 192, 0);
    border-bottom: 0.25rem solid rgba(0,0,0,0);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    z-index: 9999;
    margin: 0 0 10px 10px;
    margin-left: 8px;
  }

  .spinner--hidden {
    display: none;
  }

  .htmx-request {
    display: unset;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
.button-group {
  margin: 40px 0 20px;
}
#article-props-container {
  padding: 30px;
  font-size: 0.8rem;
}
#article-props-container h1 {
  font-size: 1rem;
}
input[type=checkbox] {
  width: 20px;
  height: 20px;
}
</style>